KA:AddToggle({
    Name = "BlackFlash Loop",
    Default = false,
    Callback = function(v)
        ToggleBF = v

        if v then
            task.spawn(function()
                while ToggleBF do
                    local mob = GetNearestMobInRange(100)

                    -- Check Six Eyed Calamity stunned
                    local calamity = workspace:FindFirstChild("Objects")
                        and workspace.Objects:FindFirstChild("Mobs")
                        and workspace.Objects.Mobs:FindFirstChild("Six Eyed Calamity")

                    local isCalamityStunned = false
                    if calamity and calamity:FindFirstChild("Humanoid")
                        and calamity.Humanoid:FindFirstChild("CombatAgent")
                        and calamity.Humanoid.CombatAgent:FindFirstChild("Statuses")
                        and calamity.Humanoid.CombatAgent.Statuses:FindFirstChild("Stunned") then

                        isCalamityStunned = true
                    end

                    -- Nếu có mob hoặc Calamity bị stun
                    if mob or isCalamityStunned then
                        local args = {1.123}
                        local rs = game:GetService("ReplicatedStorage").Remotes.Server.Combat

                        rs.ApplyBlackFlashToNextHitbox:FireServer(unpack(args))
                        rs.M2:FireServer()
                    end

                    task.wait(0.3)
                end
            end)
        end
    end
})
