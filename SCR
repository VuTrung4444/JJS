repeat task.wait() until game:IsLoaded()

local Library = loadstring(game:GetObjects("rbxassetid://7657867786")[1].Source)()
local Subs = Library.subs
local IsOpen = Subs.Wait

local mainMenuPlaceID = 10450270085
local placeId = game.PlaceId

-- Biến kiểm soát
local InnateSpinEnabled = false
local slot1Enabled = false
local slot2Enabled = false
local huntLegendary = false  
local huntSg = false

-- Danh sách Innate
local legendaryInnate = {"Volcano", "Hydrokinesis", "Judgeman", "Puppet", "Projection", "Plan Manipulation"}
local sgInnate = {"Infinity", "Demon Vessel", "Curse Queen", "Soul Manipulation", "Gamble Fever", "Star Rage", "Ancient Construction", "Thunder God"}

-- Lấy danh sách Innate cần hunt
local function getFilteredInnate()
    local targetInnate = {}
    if huntLegendary then
        for _, innate in ipairs(legendaryInnate) do
            table.insert(targetInnate, innate)
        end
    end
    if huntSg then
        for _, innate in ipairs(sgInnate) do
            table.insert(targetInnate, innate)
        end
    end
    return targetInnate
end

-- Hàm auto spin Innate
local function autoSpinInnate()
    task.spawn(function()
        local Players = game:GetService("Players")
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local localPlayer = Players.LocalPlayer

        -- Remote spin
        local spinRemote = ReplicatedStorage:WaitForChild("Remotes")
            :WaitForChild("Server")
            :WaitForChild("Data")
            :WaitForChild("InnateSpin")

        -- Innates
        local innates = localPlayer:WaitForChild("ReplicatedData"):WaitForChild("innates")

        while InnateSpinEnabled do
            local targetInnates = getFilteredInnate()

            -- Spin slot 1
            if slot1Enabled then
                spinRemote:InvokeServer(1)
                local val1 = innates["1"] and innates["1"].Value or ""
                print("Slot 1 Innate:", val1)
                if table.find(targetInnates, val1) then
                    InnateSpinEnabled = false
                    break
                end
            end

            -- Spin slot 2
            if slot2Enabled then
                if slot1Enabled then task.wait(0.5) end -- Slot 2 quay chậm hơn nếu slot 1 cũng spin
                spinRemote:InvokeServer(2)
                local val2 = innates["2"] and innates["2"].Value or ""
                print("Slot 2 Innate:", val2)
                if table.find(targetInnates, val2) then
                    InnateSpinEnabled = false
                    break
                end
            end

            task.wait(0.3)
        end
    end)
end

-- GUI setup
if game.PlaceId == mainMenuPlaceID then
    local Window = Library:CreateWindow({
        Name = "HackerLor",
        Themeable = {
            Info = "VTrungHackerLor",
            Credit = false,
            Background = "",
            Visible = true
        }
    })

	--// Main Tab \\--
	local MainTab = Window:CreateTab({Name = "Main"})
	local MainSection = MainTab:CreateSection({Name = "Farming"})
	local Settings = MainTab:CreateSection({Name = "Settings"})
	local DailySection = MainTab:CreateSection({Name = "Spin", Side = "Left"})
	local KA = MainTab:CreateSection({Name = "Kill Aura", Side = "Left"})
	local Teleports = MainTab:CreateSection({Name = "Teleports", Side = "Right"})
	local Info = MainTab:CreateSection({Name = "Info", Side = "Right"})
	local AuraTab = MainTab:CreateSection({Name = "AuraSkills", Side = "Left"})


	--// Misc Tab \\--
	local MiscTab = Window:CreateTab({Name = "Misc"})
	local MiscSection = MiscTab:CreateSection({Name = "Misc"})
	local HopServer = MiscTab:CreateSection({Name = "Hop", Side = "Left"})
	local Breathings = MiscTab:CreateSection({Name = "Breathings", Side = "Left"})
	local SpeedAndJump = MiscTab:CreateSection({Name = "Speed&Jump", Side = "Right"})
	local Ect = MiscTab:CreateSection({Name = "Ect", Side = "Left"})


    -- Toggle Auto Spin
    DailySection:AddToggle({
        Name = "Auto Spin Innate",
        Flag = "AutoSpinInnate",
        Callback = function(state)
            InnateSpinEnabled = state
            if state then autoSpinInnate() end
        end
    })

    -- Toggle slot 1
    DailySection:AddToggle({
        Name = "Spin Thanh Lưu 1",
        Flag = "Slot1",
        State = false,
        Callback = function(state)
            slot1Enabled = state
        end
    })

    -- Toggle slot 2
    DailySection:AddToggle({
        Name = "Spin Thanh Lưu 2",
        Flag = "Slot2",
        State = false,
        Callback = function(state)
            slot2Enabled = state
        end
    })

    -- Hunt Legendary / SG Innate
    local ClanChooseSection = MainTab:CreateSection({Name = "TròChơiNhânPhẩm", Side = "Right"})

    ClanChooseSection:AddToggle({
        Name = "Săn Legendary Innate",
        Flag = "HuntLegendary",
        Callback = function(state)
            huntLegendary = state
        end
    })

    ClanChooseSection:AddToggle({
        Name = "Săn Sg Innate",
        Flag = "HuntSg",
        Callback = function(state)
            huntSg = state
        end
    })



	--// Kill Aura Toggle \\--
	KA:AddToggle({
		Name = "Kill Aura",
		Flag = "KillAuraToggle",
		Callback = function(v)
			getgenv().KillAura = v
		end
	})


HopServer:AddToggle({
    Name = "HopServer",
    Flag = "HopServerToggle",
    Callback = function(state)
        getgenv().HopServerEnabled = state
        if state then
            task.spawn(function()
                while getgenv().HopServerEnabled do
                    -- Hàm hop server
                    local HttpService = game:GetService("HttpService")
                    local TeleportService = game:GetService("TeleportService")
                    local Players = game:GetService("Players")
                    local placeId = game.PlaceId

                    local function getLowPopServer()
                        local url = string.format("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Asc&limit=100", placeId)
                        local success, response = pcall(function()
                            return game:HttpGet(url)
                        end)
                        if success and response then
                            local data = HttpService:JSONDecode(response)
                            for _, server in ipairs(data.data) do
                                if server.playing == 1 and server.maxPlayers > 1 then
                                    return server.id
                                end
                            end
                        end
                    end

                    local function hopToLowPopServer()
                        local serverId = getLowPopServer()
                        if serverId then
                            TeleportService:TeleportToPlaceInstance(placeId, serverId, Players.LocalPlayer)
                        end
                    end

                    hopToLowPopServer()

                    task.wait(10)
                end
            end)
        end
    end
})

	
end	

--// References \\--
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local workspace = game:GetService("Workspace")
local plr = Players.LocalPlayer
local MAX_DISTANCE = 100
local ATTACK_COUNT = 10
local WAIT_AFTER_ATTACK = 2

local function getClosestMob()
    local mobsFolder = workspace:WaitForChild("Objects"):WaitForChild("Mobs")
    local closestMob = nil
    local closestDistance = math.huge

    for _, mob in ipairs(mobsFolder:GetChildren()) do
        if mob:IsA("Model") then
            local humanoid = mob:FindFirstChild("Humanoid")
            local rootPart = mob:FindFirstChild("HumanoidRootPart")
            if humanoid and humanoid.Health > 0 and rootPart then
                local distance = (rootPart.Position - plr.Character.HumanoidRootPart.Position).Magnitude
                if distance < MAX_DISTANCE and distance < closestDistance then
                    closestDistance = distance
                    closestMob = mob
                end
            end
        end
    end

    return closestMob
end

local function attack(target)
    if not target then return end
    local humanoid = target:FindFirstChild("Humanoid")
    local rootPart = target:FindFirstChild("HumanoidRootPart")
    if not humanoid or humanoid.Health <= 0 or not rootPart then return end

    local playerRoot = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
    if not playerRoot then return end

    local distance = (rootPart.Position - playerRoot.Position).Magnitude
    if distance > MAX_DISTANCE then return end

    local args = {1, {humanoid}}
    ReplicatedStorage
        :WaitForChild("Remotes")
        :WaitForChild("Server")
        :WaitForChild("Combat")
        :WaitForChild("M1")
        :FireServer(unpack(args))
end


task.spawn(function()
    while task.wait(0.3) do
        if getgenv().KillAura and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local target = getClosestMob()
            if target then

                for i = 1, ATTACK_COUNT do
                    attack(target)
                    task.wait(0.3) 
                end

                task.wait(WAIT_AFTER_ATTACK)
            end
        end
    end
end)



	--// Variables \\--
	local plr = game:GetService("Players").LocalPlayer

	local function updateCharacterReferences(character)
		local hrp = character:WaitForChild("HumanoidRootPart")
			_G.Character = character
			_G.HumanoidRootPart = hrp
	end
		if plr.Character then
			updateCharacterReferences(plr.Character)
		end
		plr.CharacterAdded:Connect(function(character)
		updateCharacterReferences(character)
	end)

	local insert = table.insert 
	local character = plr.Character
	local PlrHumanoidRootPart = character:WaitForChild("HumanoidRootPart")

	local plr = game.Players.LocalPlayer
	local Character = plr.Character or plr.CharacterAdded:Wait()	
	local Humanoid = Character and Character:WaitForChild("Humanoid")
	local WalkSpeed = 150
	local JumpPower = 150

	plr.CharacterAdded:Connect(function(Char)
		Character = Char
		Humanoid = Character:WaitForChild("Humanoid")

		-- Cập nhật tốc độ và sức bật ngay khi nhân vật xuất hiện
		if WalkSpeed then
			Humanoid.WalkSpeed = WalkSpeed
		end
		if JumpPower then
			Humanoid.JumpPower = JumpPower
		end
	end)

	game:GetService("RunService").Stepped:Connect(function()
		if Character and Humanoid then
			-- Giữ tốc độ chạy cố định
			if Humanoid.WalkSpeed ~= WalkSpeed then
				Humanoid.WalkSpeed = WalkSpeed
			end
			
			-- Giữ sức bật cố định
			if Humanoid.JumpPower ~= JumpPower then
				Humanoid.JumpPower = JumpPower
			end
		end
	end)

	plr.CharacterAdded:Connect(function(Char)
		Character = Char
		Humanoid = Character:WaitForChild("Humanoid")

		-- Đặt lại tốc độ ngay lập tức
		task.wait(0.1) -- Chờ game cập nhật xong
		Humanoid.WalkSpeed = WalkSpeed
		Humanoid.JumpPower = JumpPower
	end)


	local RunService = game:GetService("RunService");
	local Players = game:GetService("Players");
	local Player = Players.LocalPlayer;
	local chr = Player.Character
	local root = chr and chr:FindFirstChild("HumanoidRootPart")
	local NextFrame = RunService.Heartbeat;


	local VirtualUser = game:GetService("VirtualUser")
	local Players = game:GetService("Players")
	local player = Players.LocalPlayer
	local ReplicatedStorage = game:GetService("ReplicatedStorage")
	local Remotes = ReplicatedStorage:WaitForChild("Remotes")
	local Map = Workspace:WaitForChild("Map")


	local activeToggle = nil
	local toggles = {}





	--// Tween \\--
	local function GetDistance(Endpoint)
		if typeof(Endpoint) == "Instance" then
			Endpoint = Vector3.new(Endpoint.Position.X, game.Players.LocalPlayer.Character.HumanoidRootPart.Position.Y, Endpoint.Position.Z)
		elseif typeof(Endpoint) == "CFrame" then
			Endpoint = Vector3.new(Endpoint.Position.X, game.Players.LocalPlayer.Character.HumanoidRootPart.Position.Y, Endpoint.Position.Z)
		end
		local Magnitude = (Endpoint - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
		return Magnitude
	end

	function Tween(Endpoint)
	if typeof(Endpoint) == "Instance" then
			Endpoint = Endpoint.CFrame
		end
		local TweenFunc = {}
		local Distance = GetDistance(Endpoint)
		local TweenInfo = TweenInfo.new(Distance / getgenv().tweenspeed, Enum.EasingStyle.Linear)

		local targetCFrame = Endpoint

		-- Giữ nguyên hướng nhìn khi ở chế độ "Above" hoặc "Below"
		if FarmMethod == "Above" then
			targetCFrame = CFrame.new(Endpoint.Position) * CFrame.Angles(math.rad(-90), 0, 0)
		elseif FarmMethod == "Below" then
			targetCFrame = CFrame.new(Endpoint.Position) * CFrame.Angles(math.rad(90), 0, 0)
		end

		local TweenObj = game:GetService("TweenService"):Create(
			game.Players.LocalPlayer.Character.HumanoidRootPart, 
			TweenInfo, 
			{ CFrame = targetCFrame }
		)
		TweenObj:Play()

		function TweenFunc:Cancel()
			TweenObj:Cancel()
			return false
		end

		if Distance <= 100 then
			game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = targetCFrame
			TweenObj:Cancel()
			return false
		end

		return TweenFunc
	end

	local function EnableAntiFall()
		local plr = game.Players.LocalPlayer
		if not plr.Character or not plr.Character:FindFirstChild("HumanoidRootPart") then
			return
		end

		local humanoidRootPart = plr.Character.HumanoidRootPart
		if not humanoidRootPart:FindFirstChild("BodyVelocity") then
			local antifall = Instance.new("BodyVelocity")
			antifall.Velocity = Vector3.new(0, 0, 0)
			antifall.MaxForce = Vector3.new(9e9, 9e9, 9e9)
			antifall.Name = "BodyVelocity"
			antifall.Parent = humanoidRootPart
		end
	end

	local function DisableAntiFall()
		local plr = game.Players.LocalPlayer
		if not plr.Character or not plr.Character:FindFirstChild("HumanoidRootPart") then
			return
		end

		local humanoidRootPart = plr.Character.HumanoidRootPart
		local humanoid = plr.Character:FindFirstChildOfClass("Humanoid")
		local antifall = humanoidRootPart:FindFirstChild("BodyVelocity")

		-- Xóa lực AntiFall nếu tồn tại
		if antifall then
			antifall:Destroy()
			task.wait(0.1)
		end

		-- Đặt lại vận tốc để tránh bị giữ lại bởi lực cũ
		humanoidRootPart.Velocity = Vector3.new(0, 0, 0)
		humanoidRootPart.AssemblyLinearVelocity = Vector3.new(0, 0, 0)

		-- Đảm bảo nhân vật có thể di chuyển
		if humanoid then
			humanoid.PlatformStand = false  -- Ngăn trạng thái đứng yên cứng
			humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)  -- Đưa nhân vật về trạng thái bình thường
			task.wait(0.1)  -- Chờ một chút để trạng thái được cập nhật

			-- Nhảy ngay lập tức để kiểm tra xem có bị khóa không
			humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end


	--// Get Closest \\---
	function IsEntitySelected(entity, selectedEntities)
		for _, selectedEntity in ipairs(selectedEntities) do
			if entity.Name == selectedEntity then
				return true
			end
		end
		return false
	end



	function getclosest(selectedEntities, parentFolder)
		local closestEntity = nil
		local closestDistance = math.huge

		local entities = parentFolder:GetDescendants()

		for i, entity in ipairs(entities) do
			if entity:IsA("Model") and IsEntitySelected(entity, selectedEntities) then
				local entityName = entity.Name
				local humanoid = entity:FindFirstChild("Humanoid")
				if humanoid and humanoid.Health > 0 then
					local entityCFrame = entity:GetModelCFrame()
					local distance = (entityCFrame.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
					if distance < closestDistance then
						closestDistance = distance
						closestEntity = entity
					end
				end
			end
		end

		return closestEntity
	end




	local SelectedMap = nil 
	local LocationsDropdown, BossesDropdown -- Lưu Dropdown để cập nhật danh sách
	local Map1List, Map2List, BossesMap1List, BossesMap2List = {}, {}, {}, {}
	local LocationsToUse, BossesToUse = {}, {}
	local ActiveBossLocations = {}

	for name, _ in pairs(Map1) do
		table.insert(Map1List, name)
	end
	for name, _ in pairs(Map2) do
		table.insert(Map2List, name)
	end
	for name, _ in pairs(BossLocationsMap1) do
		table.insert(BossesMap1List, name)
	end
	for name, _ in pairs(BossLocationsMap2) do
		table.insert(BossesMap2List, name)
	end




	local Bosses = {}
	local mobs = {}


